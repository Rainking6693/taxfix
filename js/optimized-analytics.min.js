class OptimizedAnalytics{constructor(){this.scriptsLoaded=false;this.eventQueue=[];this.init();}init(){if(document.readyState==='complete'){this.loadAnalytics();}else{window.addEventListener('load',()=>{setTimeout(()=> this.loadAnalytics(),2000);});}}loadAnalytics(){if(this.scriptsLoaded)return;this.scriptsLoaded=true;this.loadGTM();this.loadGA();setTimeout(()=> this.loadTikTok(),3000);this.processEventQueue();this.setupEventTracking();this.initFormTracking();}loadGTM(){if(window.google_tag_manager)return;window.dataLayer=window.dataLayer || [];window.dataLayer.push({'gtm.start': new Date().getTime(),event: 'gtm.js'});const script=document.createElement('script');script.async=true;script.src='https: document.head.appendChild(script);}loadGA(){if(window.gtag)return;window.dataLayer=window.dataLayer || [];window.gtag=function(){dataLayer.push(arguments);};const script=document.createElement('script');script.async=true;script.src='https: script.onload=()=>{gtag('js',new Date());gtag('config','G-NXRE0N1G3N');gtag('config','AW-17289413913');gtag('config','AW-17292811511');};document.head.appendChild(script);}loadTikTok(){if(window.ttq)return;!function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t] || [];ttq.methods=["track","page","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"];ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i < ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t] || [],n=0;n < ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e};ttq.load=function(e,n){var i="https: ttq._i=ttq._i ||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t ||{},ttq._t[e]=+new Date,ttq._o=ttq._o ||{},ttq._o[e]=n ||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};ttq.load('D1NRARBC77U41SK2MMV0');ttq.page();}(window,document,'ttq');}trackEvent(eventName,parameters={}){if(this.scriptsLoaded && window.gtag){gtag('event',eventName,parameters);}else{this.eventQueue.push({eventName,parameters});}}processEventQueue(){while(this.eventQueue.length > 0){const{eventName,parameters}=this.eventQueue.shift();if(window.gtag){gtag('event',eventName,parameters);}}}setupEventTracking(){document.addEventListener('click',(e)=>{this.handleClick(e);},{passive: true});this.trackEvent('page_view',{'event_category': 'engagement','page_title': document.title,'page_location': window.location.href});}handleClick(e){const target=e.target.closest('a,button');if(!target)return;const href=target.href || '';const text=target.textContent.trim();if(href.includes('hiddenprofitfinder')|| text.includes('Find Your Missing')|| text.includes('Find My Hidden')){this.trackEvent('hidden_profit_finder_click',{'event_category': 'engagement','event_label': 'Hidden Profit Finder Button','button_text': text,'button_location': this.getButtonLocation(target)});}if(href.includes('taxtok.gumroad.com/l/okjyj')|| text.includes('Get Tax Fix Pack')|| text.includes('DIY Toolkit')){this.trackEvent('tax_fix_pack_click',{'event_category': 'conversion','event_label': 'Tax Fix Pack Button','button_text': text,'button_location': this.getButtonLocation(target),'value': 29});}if(href.includes('calendar.app.google')|| text.includes('Professional Tax Help')|| text.includes('Get Started')){this.trackEvent('professional_help_click',{'event_category': 'conversion','event_label': 'Professional Tax Help Button','button_text': text,'button_location': this.getButtonLocation(target)});}if(target.classList.contains('widget-cta-btn')){this.trackEvent('calculator_widget_cta_click',{'event_category': 'conversion','event_label': 'Homepage Calculator CTA','button_text': text});}}getButtonLocation(element){const section=element.closest('section,header,footer');if(section){return section.className || section.tagName.toLowerCase();}return 'unknown';}setupFormTracking(){document.addEventListener('submit',(e)=>{if(e.target.tagName==='FORM'){const formId=e.target.id || 'unknown';let eventLabel='Form Submit';if(formId==='homepage-calculator'){eventLabel='Homepage Calculator';this.trackEvent('homepage_calculator_used',{'event_category': 'engagement','event_label': 'Homepage Calculator Widget'});}else if(formId==='newsletter-footer-form'){eventLabel='Footer Newsletter Signup';this.trackEvent('email_signup',{'event_category': 'conversion','event_label': 'Footer Newsletter Signup'});}this.trackEvent('form_submission',{'event_category': 'engagement','event_label': eventLabel,'form_id': formId});}},{passive: true});}initFormTracking(){this.setupFormTracking();}}window.optimizedAnalytics=new OptimizedAnalytics();